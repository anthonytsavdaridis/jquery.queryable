/*! jquery.queryable v1.0 | https://github.com/anthonytsavdaridis/jquery.queryable | (c) 2013 */
(function(){var n,i,t,r;Object.equals=function(n,t,i){return i&&typeof n=="string"&&typeof t=="string"?n.toLowerCase()==t.toLowerCase():n===t},Object.compare=function(n,t){return n>t?1:n<t?-1:0},n=function(n){var t=this;this.source=n,this.length=0,t._init()},n.fromSource=function(t){return new n(t)},n._utilities={sort:function(n,t){for(var i,f,e=t.pop(),u,r=0;r<n.length;r++)for(i=0;i<n.length-1;i++)u=!0,$.each(t,function(t,r){if(r(n[i],n[i+1])!=0)return u=!1,!1}),u&&e(n[i],n[i+1])==1&&(f=n[i+1],n[i+1]=n[i],n[i]=f);return n},parseExpression:function(n){var i=null,r,u,t;if(n==null)i=function(n){return n};else{if(t=n,$.type(t)=="string"){if(r=/^[(\s]*([^()]*?)[)\s]*=>[{]?(.*)[}]?/,r.test(n))return u=n.match(r),t=new Function(u[1],"return "+u[2]+";"),t;throw new Error("cannot parse expression");}i=t}return i},getKeys:function(n){var i=[],t;for(t in n)Object.prototype.hasOwnProperty.call(n,t)&&i.push(t);return i},isComplexType:function(){return $.inArray($.type,["boolean","number","string","undefined","null"])>-1}},i=n._utilities,n.prototype={_init:function(){var n=this;this.length=this.source==null?0:this.source.length,this.source!=null&&$.each(this.source,function(t,i){n[t]=i})},queryableVersion:"1.0",toArray:function(){var n=[];return $.each(this.source,function(t,i){n.push(i)}),n},toLookup:function(t,i,r){t=n._utilities.parseExpression(t),i=i==null?function(n){return n}:n._utilities.parseExpression(i);var u={},e=r!=null,r=r||Object.equals,f=[];return $.each(this.source,function(n,o){var s=t(o,n),h;e&&(h=null,$.each(f,function(n,t){if(r(s,t))return h=t,!1}),h!=null?s=h:f.push(s)),s in u||(u[s]=[]),u[s].push(i(o,n))}),$.each(u,function(t,i){u[t]=n.fromSource(i)}),u},toDictionary:function(t,i,r){t=n._utilities.parseExpression(t),i=i==null?function(n){return n}:n._utilities.parseExpression(i);var e=r==null,u={},f=[];return $.each(this.source,function(n,o){var s=t(o,n),h;if(e)if(s in u)throw new Error("duplicate key found ("+s+")");else u[s]=i(o,n);else if(h=!1,$.each(f,function(n,t){if(r(s,t))return h=!0,!1}),h)throw new Error("duplicate key found ("+s+")");else u[s]=i(o,n),f.push(s)}),u},toJQuery:function(){return $(this.toArray())},where:function(t){var r=n._utilities.parseExpression(t),i=[];return $.each(this.source,function(n,t){r(t,n)&&i.push(t)}),n.fromSource(i)},contains:function(n,t){t=t||Object.equals;var i=!1;return $.each(this.source,function(r,u){return i=t(n,u),!i}),i},count:function(t){return t!=null?this.where(n._utilities.parseExpression(t)).length:this.length},forEach:function(n){$.each(this.source,function(t,i){n(i,t)})},take:function(t){var i=this.source.slice(0,t);return n.fromSource(i)},takeWhile:function(t){var r=n._utilities.parseExpression(t),i=[];return $.each(this.source,function(n,t){if(r(t,n))i.push(t);else return!1}),n.fromSource(i)},skipWhile:function(t){var r=n._utilities.parseExpression(t),i=null;return $.each(this.source,function(n,t){if(!r(t,n))return!1;i=n}),i==null?n.fromSource([]):this.skip(++i)},skip:function(t){var i=this.source.slice(t);return n.fromSource(i)},first:function(n){var t=this.firstOrDefault(n);if(t==null)throw new Error("sequence contains no elements");else return t},firstOrDefault:function(n){if(n!=null)return this.where(n).firstOrDefault();var t=this.toArray();return t.length>0?t[0]:null},last:function(n){var t=this.lastOrDefault(n);if(t==null)throw new Error("sequence contains no elements");else return t},lastOrDefault:function(n){if(n!=null)return this.where(n).firstOrDefault();var t=this.toArray();return t.length>0?t[t.length-1]:null},single:function(n){var t=this.singleOrDefault(n);if(t==null)throw new Error("sequence contains no matching element");else return t},singleOrDefault:function(n){var t=this.where(n);if(t.length>1)throw new Error("found more than 1 matching elements");else return t.firstOrDefault()},elementAtOrDefault:function(n){return n in this?this[n]:null},elementAt:function(n){var t=this.elementAtOrDefault(n);return t==null?new Error("sequence contains no elements"):t},all:function(t){var r=n._utilities.parseExpression(t),i=!0;return $.each(this.source,function(n,t){return r(t,n)||(i=!1),i}),i},any:function(t){var r=n._utilities.parseExpression(t),i=!1;return $.each(this.source,function(n,t){if(r(t,n))return i=!0,!1}),i},concat:function(t){var i=null;if($.isArray(t))i=this.source.concat(t);else if(t instanceof n)i=this.source.concat(t.source);else if(t.jquery!=null)i=this.source,$.each(t,function(){i.push(this)});else throw new Error("cannot merge with this type");return n.fromSource(i)},defaultIfEmpty:function(t){return this.source.length==0?n.fromSource([t!=null?t:null]):this},distinct:function(t){var i=[],r;return t==null?$.each(this.source,function(n,t){$.inArray(t,i)==-1&&i.push(t)}):(r=t||Object.equals,$.each(this.source,function(n,t){var u=!1;$.each(i,function(){if(r(t,this))return u=!0,!1}),u||i.push(t)})),n.fromSource(i)},_orderBy:function(i,r,u){var s;i==null&&(i=function(n){return n}),i=n._utilities.parseExpression(i);for(var h=function(n,t){return(r||Object.compare)(i(n),i(t))*(u?-1:1)},f=this.parent,e=[];f!=null;){var c=f.comparer,o=f.keySelector,l=function(n,t){return(c||Object.compare)(o(n),o(t))};e.push(l),f=f.parent}return e.push(h),s=n._utilities.sort(this.source,e),t.fromSource({comparer:r,keySelector:i},s)},orderBy:function(n,t){return this._orderBy(n,t,!1)},orderByDescending:function(n,t){return this._orderBy(n,t,!0)},min:function(n){return n==null?this.orderBy().first():this.orderBy(n).first()},max:function(n){return n==null?this.orderByDescending().first():this.orderByDescending(n).first()},sum:function(t){var i=0;return t=t!=null?n._utilities.parseExpression(t):null,$.each(this.source,function(n,r){i+=t!=null?t(r,n):r}),i},average:function(t){t=t==null?function(n){return n}:n._utilities.parseExpression(t);var i=0;return $.each(this.source,function(n,r){i+=t(r,n)}),i/this.length},aggregate:function(){var u=arguments.length>1&&typeof arguments[0]!="function"?arguments[0]:null,f=n._utilities.parseExpression(arguments.length>1?arguments[1]:arguments[0]),t=arguments.length>2?arguments[2]:arguments.length==2&&typeof arguments[0]=="function"?arguments[1]:null,i,r;for(t=t==null?function(n){return n}:n._utilities.parseExpression(t),i=u==null?this.source.shift():u,r=null;r=this.source.shift();)i=f(i,r);return t(i)},reverse:function(){var t=[];return $.each(this.source,function(n,i){t.unshift(i)}),n.fromSource(t)},intersect:function(t,i){var u=i||function(n,t){return Object.equals(n,t)},r=[];return $.each(this.source,function(n,i){var f=!1;$.each(t,function(n,t){if(u(i,t))return f=!0,!1}),f&&r.push(i)}),n.fromSource(r)},groupBy:function(t,u,f,e){var h,o,s;return t=i.parseExpression(t),u=i.parseExpression(u),f!=null&&(f=i.parseExpression(f)),h=e||Object.equals,o=[],$.each(this.source,function(n,r){var f=t(r),e=i.isComplexType(f),u=null;$.each(o,function(n,t){return h(t.key,f)&&(u=t),u==null}),u==null&&(u={key:f,values:[]},o.push(u)),u.values.push(r)}),f==null?(s=[],$.each(o,function(n,t){s.push(new r(t.key,t.values))}),o=s):f!=null&&(s=[],$.each(o,function(t,i){s.push(f(i.key,n.fromSource(i.values)))}),o=s),n.fromSource(o)},_join:function(t,r,u,f,e,o){var s=[],c=e||Object.equals,h;if(r=i.parseExpression(r),u=i.parseExpression(u),f==null)throw new Error("resultSelector must be specified");return f=i.parseExpression(f),h=!1,$.each(this.source,function(i,e){var l=r(e),a=[];$.each(t,function(n,t){var i=u(t);if(!h){if($.type(l)!=$.type(i))throw new Error("inner key type missmatch");h=!0}c(l,i)&&(o?a.push(t):s.push(f(e,t)))}),o&&s.push(f(e,n.fromSource(a)))}),n.fromSource(s)},join:function(n,t,i,r,u){return this._join(n,t,i,r,u,!1)},groupJoin:function(n,t,i,r,u){return this._join(n,t,i,r,u,!0)},select:function(t){t=n._utilities.parseExpression(t);var i=[];return $.each(this.source,function(n,r){i.push(t(r))}),n.fromSource(i)},selectMany:function(t){var r=arguments.length>1?arguments[1]:null,i=[];return $.each(this.source,function(n,u){if(r==null)i=i.concat(t(u,n));else{var f=t(u,n);$.each(f,function(n,t){i.push(r(u,t,n))})}}),n.fromSource(i)},union:function(t,i){var r=this.source.concat(t);return n.fromSource(r).distinct(i)},except:function(t,i){i=i||Object.equals;var r=[];return $.each(this.source,function(n,u){var f=!1;$.each(t,function(n,t){return f=i(u,t),!f}),f||r.push(u)}),n.fromSource(r)},sequenceEqual:function(n,t){t=t||Object.equals;var i=this.source.length==n.length;return i&&$.each(this.source,function(r,u){var f=n[r];if(!t(u,f))return i=!1,!1}),i},zip:function(t,i){var u=Math.min(this.source.length,t.length),r=[];return $.each(this.source,function(n,f){if(n+1>u)return!1;r.push(i(f,t[n]))}),n.fromSource(r)}},t=function(n,t){if(n==null)throw new Error("parentQueryable must be specified");this.parent=n,this.source=t,this.length=0,this._init()},$.extend(t,n),t.prototype=new n,t.prototype.constructor=t,t.fromSource=function(n,i){return new t(n,i)},t.prototype.thenBy=n.prototype.orderBy,t.prototype.thenByDescending=n.prototype.orderByDescending,r=function(n,t){this.key=n,this.source=t,this.length=0,this._init()},$.extend(r,n),r.prototype=new n,r.prototype.constructor=r,$.queryable=n.fromSource,$.q=n.fromSource,$.fn.asQueryable=function(){return n.fromSource(this)}})();
